<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Register</title>
    <script type="module">
        import { getBonusType } from './bonuscodes.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBmnEMGPec-dzIANP0pvGT3Lbvm51zFjaY",
            authDomain: "knoedelbrot-1d1de.firebaseapp.com",
            projectId: "knoedelbrot-1d1de",
            storageBucket: "knoedelbrot-1d1de.firebasestorage.app",
            messagingSenderId: "906476242509",
            appId: "1:906476242509:web:989fbc20dee736f1eb7e04"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.registerUser = async function() {
            const email = document.getElementById("email").value;
            const pass = document.getElementById("password").value;
            const code = document.getElementById("bonuscode").value.trim();

            // Bonus prÃ¼fen
            const bonusType = getBonusType(code);

            // User-Dokument in Firestore
            const userRef = doc(db, "users", email);
            const docSnap = await getDoc(userRef);

            if (docSnap.exists()) {
                alert("Benutzer existiert schon!");
                return;
            }

            await setDoc(userRef, {
                password: pass,
                bonus: bonusType,
                bonusCode: code
            });

            // Cookie setzen (bis Ablauf des Bonus)
            const today = new Date();
            let expDate = new Date();
            if (bonusType !== "none") {
                import { bonusCodes } from './bonuscodes.js';
                // Suche Ablaufdatum
                const b = bonusCodes.find(bc => bc.code === code);
                if (b) expDate = new Date(b.expires);
            }
            document.cookie = `bonus=${bonusType}; expires=${expDate.toUTCString()}; path=/`;

            alert("Registrierung erfolgreich!");
            window.location.href = "login.html";
        }
    </script>
</head>
<body>
    <h1>Register</h1>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Passwort"><br>
    <input type="text" id="bonuscode" placeholder="Bonuscode (optional)"><br>
    <button onclick="registerUser()">Registrieren</button>
</body>
</html>
