<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <script type="module">
        import { getBonusType, bonusCodes } from './bonuscodes.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBmnEMGPec-dzIANP0pvGT3Lbvm51zFjaY",
            authDomain: "knoedelbrot-1d1de.firebaseapp.com",
            projectId: "knoedelbrot-1d1de",
            storageBucket: "knoedelbrot-1d1de.firebasestorage.app",
            messagingSenderId: "906476242509",
            appId: "1:906476242509:web:989fbc20dee736f1eb7e04"
        };

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.loginUser = async function() {
            const email = document.getElementById("email").value;
            const pass = document.getElementById("password").value;

            const userRef = doc(db, "users", email);
            const docSnap = await getDoc(userRef);

            if (!docSnap.exists()) {
                alert("Benutzer nicht gefunden!");
                return;
            }

            const data = docSnap.data();
            if (data.password !== pass) {
                alert("Falsches Passwort!");
                return;
            }

            // Cookie fÃ¼r Bonus setzen
            let expDate = new Date();
            if (data.bonus && data.bonus !== "none") {
                const b = bonusCodes.find(bc => bc.code === data.bonusCode);
                if (b) expDate = new Date(b.expires);
            }
            document.cookie = `bonus=${data.bonus || "none"}; expires=${expDate.toUTCString()}; path=/`;

            // Login erfolgreich
            window.location.href = "profile.html?email=" + encodeURIComponent(email);
        }
    </script>
</head>
<body>
    <h1>Login</h1>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Passwort"><br>
    <button onclick="loginUser()">Anmelden</button>
</body>
</html>
